<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>代理测试页面</title>
  </head>
  <body>
    <div class="container">
      <h1>🚀代理测试</h1>

      <div class="tabs">
        <button class="tab active" data-tab="sse">SSE 测试</button>
        <button class="tab" data-tab="ws">WebSocket 测试</button>
        <button class="tab" data-tab="proxy">代理测试</button>
      </div>

      <!-- SSE 测试标签页 -->
      <div class="tab-content active" id="sse-tab">
        <div class="stats">
          <div class="stat-card">
            <h3>连接状态</h3>
            <div class="value" id="connectionStatus">未连接</div>
          </div>
          <div class="stat-card">
            <h3>接收消息数</h3>
            <div class="value" id="messageCount">0</div>
          </div>
          <div class="stat-card">
            <h3>连接时长</h3>
            <div class="value" id="connectionTime">0s</div>
          </div>
        </div>

        <div class="controls">
          <div class="endpoint-selector">
            <label for="endpoint">选择 SSE 端点:</label>
            <select id="endpoint">
              <option value="/api/sse">基础 SSE 端点</option>
              <option value="/api/sse/custom-retry">自定义重试间隔</option>
              <option value="/api/sse/error">错误测试端点</option>
            </select>
          </div>

          <div class="button-group">
            <button class="btn-connect" id="connectBtn">连接 SSE</button>
            <button class="btn-disconnect" id="disconnectBtn" disabled>断开连接</button>
            <button class="btn-broadcast" id="broadcastBtn">发送广播消息</button>
            <button class="btn-clear" id="clearBtn">清空消息</button>
          </div>

          <div class="status disconnected" id="status">⚠️ 未连接</div>
        </div>
      </div>

      <!-- WebSocket 测试标签页 -->
      <div class="tab-content" id="ws-tab">
        <div class="stats">
          <div class="stat-card">
            <h3>连接状态</h3>
            <div class="value" id="wsConnectionStatus">未连接</div>
          </div>
          <div class="stat-card">
            <h3>连接时长</h3>
            <div class="value" id="wsConnectionTime">0s</div>
          </div>
        </div>

        <div class="controls">
          <div class="endpoint-selector">
            <label for="wsEndpoint">选择 WebSocket 端点:</label>
            <select id="wsEndpoint">
              <option value="/ws" data-source="proxy" data-protocol="WS">
                通过代理 - WS (/ws)
              </option>
              <option
                value="ws://localhost:3003"
                data-source="direct"
                data-protocol="WS"
              >
                直连 - WS (ws://localhost:3003)
              </option>
              <option
                value="/wss"
                data-source="proxy"
                data-protocol="WSS"
                data-scheme="wss"
              >
                通过代理 - WSS (/wss, 需 HTTPS Dev Server)
              </option>
              <option
                value="wss://localhost:3004"
                data-source="direct"
                data-protocol="WSS"
              >
                直连 - WSS (wss://localhost:3004)
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="wsMessage">消息内容:</label>
            <input
              id="wsMessage"
              type="text"
              placeholder='{"action":"ping"} 或 任意文本'
            />
          </div>

          <div class="button-group">
            <button class="btn-connect" id="wsConnectBtn">
              连接 WebSocket
            </button>
            <button class="btn-disconnect" id="wsDisconnectBtn" disabled>
              断开连接
            </button>
            <button class="btn-send" id="wsSendBtn" disabled>
              发送消息
            </button>
            <button class="btn-clear" id="wsClearBtn">清空日志</button>
          </div>

          <div class="status disconnected" id="wsStatus">⚠️ 未连接</div>
          <p class="hint">
            🔒 WSS 测试需要浏览器信任本地自签名证书，可通过
            https://localhost:3002 访问一次接受风险。
          </p>
        </div>
      </div>

      <!-- 代理测试标签页 -->
      <div class="tab-content" id="proxy-tab">
        <div class="controls">
          <div class="form-row">
            <div class="form-group">
              <label for="proxyEndpoint">代理端点:</label>
              <select id="proxyEndpoint">
                <option value="/api/http-test">HTTP 代理测试 (/api)</option>
                <option value="/api-https/https-test">HTTPS 代理测试 (/api-https)</option>
                <option value="/api/test">普通 API 测试</option>
              </select>
            </div>
            <div class="form-group">
              <label for="httpMethod">HTTP 方法:</label>
              <select id="httpMethod">
                <option value="GET">GET</option>
                <option value="POST">POST</option>
                <option value="PUT">PUT</option>
                <option value="DELETE">DELETE</option>
                <option value="PATCH">PATCH</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="requestBody">请求体 (JSON):</label>
            <textarea id="requestBody" placeholder='{"key": "value"}'></textarea>
          </div>

          <div class="form-group">
            <label>HTTPS 选项 (仅用于 HTTPS 代理):</label>
            <div class="checkbox-group">
              <input type="checkbox" id="rejectUnauthorized" checked />
              <label for="rejectUnauthorized">rejectUnauthorized (验证证书)</label>
            </div>
            <div class="checkbox-group" style="margin-top: 8px">
              <input type="checkbox" id="secure" checked />
              <label for="secure">secure (启用 TLS)</label>
            </div>
          </div>

          <div class="button-group">
            <button class="btn-send" id="sendProxyBtn">发送代理请求</button>
            <button class="btn-clear" id="clearProxyBtn">清空日志</button>
          </div>
        </div>
      </div>

      <div class="messages">
        <h2>📨 消息日志</h2>
        <div id="messageList"></div>
      </div>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>

